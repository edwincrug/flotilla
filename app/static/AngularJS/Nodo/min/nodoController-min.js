registrationModule.controller("nodoController",function(o,e,t,a,r,n,c,i){o.isLoading=!1,o.idProceso=1,o.perfil=1,o.idRol=20,o.idFase=1;var s=function(o,e,t,r){$("#btnEnviar").button("reset"),a.error("Ocurrio un problema")};o.init=function(){o.empleado=t.get("employeeLogged"),o.unidad=t.get("currentVIN"),n.getHeader(o.unidad.vin).success(d).error(s),c.getRolPermiso(o.empleado.idRol).success(u).error(s)};var d=function(e,t,a,n){o.unidadHeader=e,o.currentPage=o.unidadHeader.faseActual,r.getFasePermiso(o.empleado.idRol).success(l).error(s)},u=function(e,t,a,r){o.rolPermiso=e};o.mostrarNodos=function(e){r.getFasePermiso(o.idRol).success(l).error(s)},o.VerOrdenPadre=function(o){location.href="/?id="+o.folioPadre+"&employee=1"},o.VerOrdenHijo=function(o){location.href="/?id="+o.folioHijo+"&employee=1"};var l=function(e,t,a,r){o.listaNodos=e,o.numElements=e.length,setTimeout(function(){$("ul#standard").roundabout({btnNext:".next",btnNextCallback:function(){f(".next")},btnPrev:".prev",btnPrevCallback:function(){f(".prev")},clickToFocusCallback:function(){f(".next")}}),p(o.currentPage)},1),n.getUnidad(o.unidadHeader.vin).success(b).error(s)},b=function(e,t,r,n){o.unidad=e,a.success("Datos de la unidad cargados.")},f=function(e){o.currentPage=$("ul#standard").roundabout("getChildInFocus")+1,0!=o.listaNodos[o.currentPage-1].enabled?p(o.currentPage):(a.warning("El nodo "+o.currentPage+" no est√° disponible para su perfil."),$(e).click())};o.setPage=function(e){o.currentPage=e.idFase,p(o.currentPage)};var p=function(e){$("ul#standard").roundabout("animateToChild",e-1),o.currentNode=o.listaNodos[e-1],m(),x()},m=function(){angular.forEach(o.listaNodos,function(e,t){t==o.currentPage-1?e.active=1:e.active=0}),v()},g=function(e,t,a,r){o.isLoading=!1,o.listaAlertas=e,v()},h=function(e,t,a,n){o.listaDocumentos=e,r.getDocFasePermiso(o.idRol,o.idFase).success(g).error(s)},x=function(){o.isLoading=!0,v(),r.getDocFasePermiso(o.idRol,o.idFase).success(h).error(s)},v=function(){"$apply"!=o.$root.$$phase&&"$digest"!=o.$root.$$phase&&o.$apply()};o.Cargar=function(){$("#frameUpload").attr("src","/uploader"),$("#modalUpload").modal("show"),e.currentUpload=doc},o.mostrarAccesorio=function(){$("#viewAccesorio").modal("show")},o.ocultarAccesorio=function(){$("#viewAccesorio").modal("hide")},$("[name='cbxGatoUni']").bootstrapSwitch(),$("[name='cbxLlaveTuerca']").bootstrapSwitch(),$("[name='cbxManeral']").bootstrapSwitch(),$("[name='cbxRefaccion']").bootstrapSwitch(),$("[name='cbxTapAlfombra']").bootstrapSwitch(),$("[name='cbxTapPlastico']").bootstrapSwitch(),$("[name='cbxTriSeguridad']").bootstrapSwitch(),$("[name='cbxBirlo']").bootstrapSwitch(),$("[name='cbxCable']").bootstrapSwitch(),$("[name='cbxExtintor']").bootstrapSwitch(),$("[name='cbxOtro']").bootstrapSwitch(),$("#txtOtroAcc").hide($("#cbxOtroAcc").bootstrapSwitch("state")),$("#cbxOtroAcc").on("switchChange.bootstrapSwitch",function(o,e){1==e?$("#txtOtroAcc").show(1e3,function(){$("#cbxOtroAcc").bootstrapSwitch("state")}):$("#txtOtroAcc").hide(1e3,function(){$("#cbxOtroAcc").bootstrapSwitch("state")})}),o.FinishUpload=function(t){a.success("Imagen "+t+" Cargada");var r=e.currentUpload;o.vinMio="1G1YY25R695700001",i.saveFile(o.vinMio,40).success(P).error(s)},o.Guardar=function(e,t){null!=o.unidadHeader.vin&&null!=e&&""!=t&&(n.getExisteDocumento(o.unidadHeader.vin,e).success(w).error(s),1==o.existeDocumento.Existe?n.insertDocumento(o.unidadHeader.vin,e,t).success(P).error(s):n.updateDocumento(o.unidadHeader.vin,e,t).success(P).error(s))};var w=function(e,t,r,n){o.existeDocumento=e,a.success("Datos de unidad propiedad cargados.")},P=function(o,e,t,r){a.success("Datos de la unidad guardados.")};o.Regresar=function(){location.href="/busqueda"}});